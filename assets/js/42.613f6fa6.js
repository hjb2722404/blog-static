(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{206:function(s,a,t){"use strict";t.r(a);var n=t(0),l=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("div",{staticClass:"content"},[t("p",[s._v("###与第三方库的共处")]),s._v(" "),t("p",[s._v("有时我们想要的功能angular模块库里并没有提供，而其他第三方库提供了，这时候就需要让angular与第三方库很好的共处。")]),s._v(" "),t("p",[s._v("例如，在使用微信支付时，我们需要在页面中引入weixin-js-sdk:")]),s._v(" "),t("pre",{staticClass:"prettyprint"},[s._v("    <html ng-app="),t("span",{staticClass:"hljs-string"},[s._v("'myApp'")]),s._v(">\n    <head>\n    "),t("span",{staticClass:"hljs-keyword"},[s._v("...")]),s._v("\n    <script src="),t("span",{staticClass:"hljs-string"},[s._v('"http://res.wx.qq.com/open/js/jweixin-1.0.0.js"')]),s._v("><\/script>\n  </head>\n    "),t("span",{staticClass:"hljs-keyword"},[s._v("...")])]),s._v(" "),t("p",[s._v("然后我们需要将第三方库的调用初始化一下：")]),s._v(" "),t("pre",{staticClass:"prettyprint"},[s._v("angular\n    .module("),t("span",{staticClass:"hljs-string"},[s._v("'static'")]),s._v(")\n    .run(runBlock);\n\n  "),t("span",{staticClass:"hljs-comment"},[s._v("/**"),t("span",{staticClass:"hljs-phpdoc"},[s._v(" @ngInject")]),s._v(" */")]),s._v("\n  "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),t("span",{staticClass:"hljs-title"},[s._v("runBlock")]),t("span",{staticClass:"hljs-params"},[s._v("("),t("span",{staticClass:"hljs-variable"},[s._v("$http")]),s._v(",wtConfig,toastr)")]),s._v("{")]),s._v("\n      "),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" url = wtConfig.apiHost +"),t("span",{staticClass:"hljs-string"},[s._v('"/api/getSignature?url="')]),s._v("+location.origin + location.pathname;\n      "),t("span",{staticClass:"hljs-variable"},[s._v("$http")]),s._v(".get(url)\n          .then("),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),t("span",{staticClass:"hljs-params"},[s._v("(res)")]),s._v("{")]),s._v("\n              wx.config({\n                  debug: "),t("span",{staticClass:"hljs-keyword"},[s._v("false")]),s._v(", "),t("span",{staticClass:"hljs-comment"},[s._v("// 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。")]),s._v("\n                  appId: res.data.appId, "),t("span",{staticClass:"hljs-comment"},[s._v("// 必填，公众号的唯一标识")]),s._v("\n                  timestamp: res.data.timestamp, "),t("span",{staticClass:"hljs-comment"},[s._v("// 必填，生成签名的时间戳")]),s._v("\n                  nonceStr: res.data.nonceStr, "),t("span",{staticClass:"hljs-comment"},[s._v("// 必填，生成签名的随机串")]),s._v("\n                  signature: res.data.signature,"),t("span",{staticClass:"hljs-comment"},[s._v("// 必填，签名，见附录1")]),s._v("\n                  jsApiList: ["),t("span",{staticClass:"hljs-string"},[s._v("'chooseWXPay'")]),s._v("] "),t("span",{staticClass:"hljs-comment"},[s._v("// 必填，需要使用的JS接口列表，所有JS接口列表见附录2")]),s._v("\n              });\n          })\n          ."),t("span",{staticClass:"hljs-keyword"},[s._v("catch")]),s._v("("),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),t("span",{staticClass:"hljs-params"},[s._v("(res)")]),s._v("{")]),s._v("\n              toastr.error(res.data.msg);\n              "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" "),t("span",{staticClass:"hljs-keyword"},[s._v("false")]),s._v(";\n          });\n  }")]),s._v(" "),t("p",[s._v("然后，在服务（service）�或工厂（factory）中调用：")]),s._v(" "),t("pre",{staticClass:"prettyprint"},[s._v("\n"),t("span",{staticClass:"php"},[s._v("        "),t("span",{staticClass:"hljs-comment"},[s._v("/*微信支付*/")]),s._v("\n\n        "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),t("span",{staticClass:"hljs-title"},[s._v("wxPay")]),t("span",{staticClass:"hljs-params"},[s._v("(payData)")]),s._v("{")]),s._v("\n            "),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" url = wtConfig.apiHost + wtConfig.wxPayUrl;\n            "),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" data = payData;\n            "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" "),t("span",{staticClass:"hljs-variable"},[s._v("$http")]),s._v(".post(url,data)\n                .then(wxPayComplete)\n                ."),t("span",{staticClass:"hljs-keyword"},[s._v("catch")]),s._v("(wxPayFailed);\n    \n            "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),t("span",{staticClass:"hljs-title"},[s._v("wxPayComplete")]),t("span",{staticClass:"hljs-params"},[s._v("(res)")]),s._v("{")]),s._v("\n                res = res.data;\n                wx.chooseWXPay({\n                    timestamp: res.timeStamp, "),t("span",{staticClass:"hljs-comment"},[s._v("// 支付签名时间戳，注意微信jssdk中的所有使用timestamp字段均为小写。但最新版的支付后台生成签名使用的timeStamp字段名需大写其中的S字符")]),s._v("\n                    nonceStr: res.nonceStr, "),t("span",{staticClass:"hljs-comment"},[s._v("// 支付签名随机串，不长于 32 位")]),s._v("\n                    package: res.package, "),t("span",{staticClass:"hljs-comment"},[s._v("// 统一支付接口返回的prepay_id参数值，提交格式如：prepay_id=***）")]),s._v("\n                    signType: res.signType, "),t("span",{staticClass:"hljs-comment"},[s._v("// 签名方式，默认为'SHA1'，使用新版支付需传入'MD5'")]),s._v("\n                    paySign: res.paySign, "),t("span",{staticClass:"hljs-comment"},[s._v("// 支付签名")]),s._v("\n                    success: "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),t("span",{staticClass:"hljs-params"},[s._v("(resp)")]),s._v(" {")]),s._v("\n                        "),t("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v("(resp){\n                            window.location.hash = "),t("span",{staticClass:"hljs-string"},[s._v("'#/msg'")]),s._v(";\n                        }\n                    }\n                });\n            }\n\n\n            "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),t("span",{staticClass:"hljs-title"},[s._v("wxPayFailed")]),t("span",{staticClass:"hljs-params"},[s._v("(res)")]),s._v("{")]),s._v("\n                toastr.error("),t("span",{staticClass:"hljs-string"},[s._v('"error:"')]),s._v("+res);\n            }\n        }\n")])]),s._v(" "),t("p",[s._v("这里有一个坑，请注意上面第22行代码，这里我为什么没有使用angular自带的$location对象来做页面跳转呢？")]),s._v(" "),t("p",[t("strong",[s._v("原因是，此处的suceess方法是属于第三方库的，它不在angular的作用域之内，所以此处不可使用angular的对象和方法。")])]),s._v(" "),t("p",[s._v("###指令内不用再包裹标示符")]),s._v(" "),t("p",[s._v("刚开始学习使用angular的同学可能会遇到这样的问题：")]),s._v(" "),t("pre",{staticClass:"prettyprint"},[t("span",{staticClass:"xml"},[s._v("\n    "),t("span",{staticClass:"hljs-tag"},[s._v("<"),t("span",{staticClass:"hljs-title"},[s._v("li")]),s._v(" "),t("span",{staticClass:"hljs-attribute"},[s._v("ng-repeat")]),s._v("="),t("span",{staticClass:"hljs-value"},[s._v('"o in obj"')]),s._v(">")]),s._v("\n\n        "),t("span",{staticClass:"hljs-tag"},[s._v("<"),t("span",{staticClass:"hljs-title"},[s._v("a")]),s._v(" "),t("span",{staticClass:"hljs-attribute"},[s._v("ng-href")]),s._v("="),t("span",{staticClass:"hljs-value"},[s._v('"javascript:;"')]),s._v(" "),t("span",{staticClass:"hljs-attribute"},[s._v("ng-click")]),s._v("="),t("span",{staticClass:"hljs-value"},[s._v('"show(')])])]),t("span",{staticClass:"hljs-expression"},[s._v("{{"),t("span",{staticClass:"hljs-variable"},[s._v("o.id")]),s._v("}}")]),t("span",{staticClass:"xml"},[t("span",{staticClass:"hljs-tag"},[t("span",{staticClass:"hljs-value"},[s._v(')"')]),s._v(">")])]),t("span",{staticClass:"hljs-expression"},[s._v("{{"),t("span",{staticClass:"hljs-variable"},[s._v("o.text")]),s._v("}}")]),t("span",{staticClass:"xml"},[t("span",{staticClass:"hljs-tag"},[s._v("</"),t("span",{staticClass:"hljs-title"},[s._v("a")]),s._v(">")]),s._v("\n\n    "),t("span",{staticClass:"hljs-tag"},[s._v("</"),t("span",{staticClass:"hljs-title"},[s._v("li")]),s._v(">")]),s._v("\n\n")])]),s._v(" "),t("p",[s._v("然后我们会发现此处的a标签虽然绑定来点击事件用来执行show()方法，但是我们点击却发现没有任何动作并且控制台会报错。")]),s._v(" "),t("p",[s._v("请牢牢记住：")]),s._v(" "),t("p",[s._v("####"),t("strong",[s._v("ng为前缀的内置指令中本身就是js表达式了，千万不要再包裹标示符")])]),s._v(" "),t("p",[s._v("那么，其实上面的示例应该改为：")]),s._v(" "),t("pre",{staticClass:"prettyprint"},[t("span",{staticClass:"xml"},[s._v("\n    "),t("span",{staticClass:"hljs-tag"},[s._v("<"),t("span",{staticClass:"hljs-title"},[s._v("li")]),s._v(" "),t("span",{staticClass:"hljs-attribute"},[s._v("ng-repeat")]),s._v("="),t("span",{staticClass:"hljs-value"},[s._v('"o in obj"')]),s._v(">")]),s._v("\n\n        "),t("span",{staticClass:"hljs-tag"},[s._v("<"),t("span",{staticClass:"hljs-title"},[s._v("a")]),s._v(" "),t("span",{staticClass:"hljs-attribute"},[s._v("ng-href")]),s._v("="),t("span",{staticClass:"hljs-value"},[s._v('"javascript:;"')]),s._v(" "),t("span",{staticClass:"hljs-attribute"},[s._v("ng-click")]),s._v("="),t("span",{staticClass:"hljs-value"},[s._v('"show(o.id)"')]),s._v(">")])]),t("span",{staticClass:"hljs-expression"},[s._v("{{"),t("span",{staticClass:"hljs-variable"},[s._v("o.text")]),s._v("}}")]),t("span",{staticClass:"xml"},[t("span",{staticClass:"hljs-tag"},[s._v("</"),t("span",{staticClass:"hljs-title"},[s._v("a")]),s._v(">")]),s._v("\n\n    "),t("span",{staticClass:"hljs-tag"},[s._v("</"),t("span",{staticClass:"hljs-title"},[s._v("li")]),s._v(">")]),s._v("\n\n")])]),s._v(" "),t("p",[s._v("这样就ok了。")])])}],!1,null,null,null);l.options.__file="2016-05-31-angularjs使用中国的一些细节.md";a.default=l.exports}}]);