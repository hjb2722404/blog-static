(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{228:function(s,t,a){"use strict";a.r(t);var n=a(0),l=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"content"},[a("p",[s._v("随着移动设备的普及，越来越多的应用需要适应移动端来构建，包括相应的前端页面。")]),s._v(" "),a("p",[s._v("在进行web前端页面开发的过程中，免不了会使用图片上传并在上传前预览的功能，有前辈已经给出了多浏览器兼容的图片上传代码，我们根据多图上传的需要做了修改，代码如下")]),s._v(" "),a("pre",{staticClass:"prettyprint"},[a("span",{staticClass:"hljs-tag"},[s._v("<"),a("span",{staticClass:"hljs-title"},[s._v("script")]),s._v(" "),a("span",{staticClass:"hljs-attribute"},[s._v("type")]),s._v("="),a("span",{staticClass:"hljs-value"},[s._v('"text/javascript"')]),s._v(">")]),a("span",{staticClass:"javascript"},[s._v("\n\n    "),a("span",{staticClass:"hljs-comment"},[s._v("//下面用于多图片上传预览功能")]),s._v("\n\n    "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),a("span",{staticClass:"hljs-title"},[s._v("setImagePreviews")]),a("span",{staticClass:"hljs-params"},[s._v("()")]),s._v(" {")]),s._v("\n\n        "),a("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" docObj = document.getElementById("),a("span",{staticClass:"hljs-string"},[s._v('"doc"')]),s._v(");\n\n        "),a("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" dd = document.getElementById("),a("span",{staticClass:"hljs-string"},[s._v('"dd"')]),s._v(");\n\n        dd.innerHTML = "),a("span",{staticClass:"hljs-string"},[s._v('""')]),s._v(";\n\n        "),a("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" fileList = docObj.files;\n\n        "),a("span",{staticClass:"hljs-keyword"},[s._v("for")]),s._v(" ("),a("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" i = "),a("span",{staticClass:"hljs-number"},[s._v("0")]),s._v("; i < fileList.length; i++) {\n\n            dd.innerHTML += "),a("span",{staticClass:"hljs-string"},[s._v("\"<div style='float:left' > <img id='img\"")]),s._v(" + i + "),a("span",{staticClass:"hljs-string"},[s._v('"\'  /> </div>"')]),s._v(";\n\n            "),a("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" imgObjPreview = document.getElementById("),a("span",{staticClass:"hljs-string"},[s._v('"img"')]),s._v("+i); \n\n            "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (docObj.files && docObj.files[i]) {\n\n                "),a("span",{staticClass:"hljs-comment"},[s._v("//火狐下，直接设img属性")]),s._v("\n\n                imgObjPreview.style.display = "),a("span",{staticClass:"hljs-string"},[s._v("'block'")]),s._v(";\n\n                imgObjPreview.style.width = "),a("span",{staticClass:"hljs-string"},[s._v("'150px'")]),s._v(";\n\n                imgObjPreview.style.height = "),a("span",{staticClass:"hljs-string"},[s._v("'180px'")]),s._v(";\n\n                "),a("span",{staticClass:"hljs-comment"},[s._v("//imgObjPreview.src = docObj.files[0].getAsDataURL();")]),s._v("\n\n                "),a("span",{staticClass:"hljs-comment"},[s._v("//火狐7以上版本不能用上面的getAsDataURL()方式获取，需要一下方式")]),s._v("\n\n               "),a("span",{staticClass:"hljs-comment"},[s._v("// imgObjPreview.src = window.URL.createObjectURL(docObj.files[i]);")]),s._v("\n                imgObjPreview.src =  getObjectURL(docObj.files[i]);\n    \n            }\n    \n            "),a("span",{staticClass:"hljs-keyword"},[s._v("else")]),s._v(" {\n    \n                "),a("span",{staticClass:"hljs-comment"},[s._v("//IE下，使用滤镜")]),s._v("\n    \n                docObj.select();\n    \n                "),a("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" imgSrc = document.selection.createRange().text;\n    \n                alert(imgSrc)\n    \n                "),a("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" localImagId = document.getElementById("),a("span",{staticClass:"hljs-string"},[s._v('"img"')]),s._v(" + i);\n    \n                "),a("span",{staticClass:"hljs-comment"},[s._v("//必须设置初始大小")]),s._v("\n    \n                localImagId.style.width = "),a("span",{staticClass:"hljs-string"},[s._v('"150px"')]),s._v(";\n    \n                localImagId.style.height = "),a("span",{staticClass:"hljs-string"},[s._v('"180px"')]),s._v(";\n    \n                "),a("span",{staticClass:"hljs-comment"},[s._v("//图片异常的捕捉，防止用户修改后缀来伪造图片")]),s._v("\n    \n                "),a("span",{staticClass:"hljs-keyword"},[s._v("try")]),s._v(" {\n    \n                    localImagId.style.filter = "),a("span",{staticClass:"hljs-string"},[s._v('"progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale)"')]),s._v(";\n    \n                    localImagId.filters.item("),a("span",{staticClass:"hljs-string"},[s._v('"DXImageTransform.Microsoft.AlphaImageLoader"')]),s._v(").src = imgSrc;\n    \n                }\n    \n                "),a("span",{staticClass:"hljs-keyword"},[s._v("catch")]),s._v(" (e) {\n    \n                    alert("),a("span",{staticClass:"hljs-string"},[s._v('"您上传的图片格式不正确，请重新选择!"')]),s._v(");\n    \n                    "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" "),a("span",{staticClass:"hljs-literal"},[s._v("false")]),s._v(";\n    \n                }\n    \n                imgObjPreview.style.display = "),a("span",{staticClass:"hljs-string"},[s._v("'none'")]),s._v(";\n    \n                document.selection.empty();\n    \n            }\n    \n        }  \n    \n        "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" "),a("span",{staticClass:"hljs-literal"},[s._v("true")]),s._v(";\n    \n    }\n    "),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" "),a("span",{staticClass:"hljs-title"},[s._v("getObjectURL")]),a("span",{staticClass:"hljs-params"},[s._v("(file)")]),s._v(" {")]),s._v("\n        "),a("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" url = "),a("span",{staticClass:"hljs-literal"},[s._v("null")]),s._v(" ;\n        "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (window.createObjectURL!="),a("span",{staticClass:"hljs-literal"},[s._v("undefined")]),s._v(") { "),a("span",{staticClass:"hljs-comment"},[s._v("// basic")]),s._v("\n            url = window.createObjectURL(file) ;\n        } "),a("span",{staticClass:"hljs-keyword"},[s._v("else")]),s._v(" "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (window.URL!="),a("span",{staticClass:"hljs-literal"},[s._v("undefined")]),s._v(") { "),a("span",{staticClass:"hljs-comment"},[s._v("// mozilla(firefox)")]),s._v("\n            url = window.URL.createObjectURL(file) ;\n        } "),a("span",{staticClass:"hljs-keyword"},[s._v("else")]),s._v(" "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (window.webkitURL!="),a("span",{staticClass:"hljs-literal"},[s._v("undefined")]),s._v(") { "),a("span",{staticClass:"hljs-comment"},[s._v("// webkit or chrome")]),s._v("\n            url = window.webkitURL.createObjectURL(file) ;\n        }\n        "),a("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" url ;\n    }\n")]),a("span",{staticClass:"hljs-tag"},[s._v("</"),a("span",{staticClass:"hljs-title"},[s._v("script")]),s._v(">")])]),s._v(" "),a("p",[s._v("大概原理注释已经写得很清楚，如果有需要的，可以根据自己的项目需求进行修改，主义最后一个获取本地图片路径的函数，是为了解决微信浏览器兼容性而编写的。")])])}],!1,null,null,null);l.options.__file="2016-05-31-兼容微信浏览器的本地图片上传预览.md";t.default=l.exports}}]);